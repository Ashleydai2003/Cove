(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[373],{6649:function(e,t,s){Promise.resolve().then(s.bind(s,4148))},4148:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w}});var a=s(7437),r=s(2265),l=s(9376),n=s(7648);class i{async fetchEvent(e){try{let t="".concat(this.baseUrl,"/event?eventId=").concat(encodeURIComponent(e)),s=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"},cache:"force-cache"});if(!s.ok){let e=await s.json().catch(()=>({message:"HTTP ".concat(s.status,": ").concat(s.statusText)}));throw Error(e.message||"Failed to fetch event: ".concat(s.statusText))}return(await s.json()).event}catch(e){if(console.error("Error fetching event:",e),e instanceof Error)throw e;throw Error("Failed to fetch event data")}}async updateRSVP(e,t,s){throw Error("RSVP functionality requires authentication - coming soon!")}constructor(e="https://api.coveapp.co"){this.baseUrl=e}}let o=new i;var c=s(936),d=s(5469),u=s(3774),x=s(2369),m=s(3145),h=s(2489),b=s(738),f=s(2148);let p=(0,b.ZF)({apiKey:"AIzaSyAniOJp4etOuRXz0_wM3dHOys24wFZ1ybM",authDomain:"cove-40d9f.firebaseapp.com",projectId:"cove-40d9f",storageBucket:"cove-40d9f.firebasestorage.app",messagingSenderId:"15922367119",appId:"1:15922367119:web:b867cc7fb136fd932fbefa"}),g=(0,f.v0)(p);function v(e){let{isOpen:t,onClose:s,onComplete:l,originalAction:n}=e,[i,o]=(0,r.useState)("phone"),[c,d]=(0,r.useState)(""),[u,x]=(0,r.useState)(""),[m,b]=(0,r.useState)(!1),[p,v]=(0,r.useState)(""),[j,y]=(0,r.useState)(null),[N,w]=(0,r.useState)(null),[E,C]=(0,r.useState)({name:"",birthdate:"",almaMater:"",gradYear:"",hobbies:[],bio:"",city:""});(0,r.useEffect)(()=>{N||w(new f.lI(g,"recaptcha-container",{size:"invisible"}))},[N]);let D=async e=>{e.preventDefault(),b(!0),v("");try{if(!N){v("reCAPTCHA not initialized. Please refresh the page.");return}let e=await (0,f.$g)(g,c,N);y(e.verificationId),o("otp")}catch(e){console.error("Firebase phone auth error:",e),v(e.message||"Failed to send OTP. Please try again.")}finally{b(!1)}},S=async e=>{e.preventDefault(),b(!0),v("");try{if(!j){v("Verification ID not found. Please try sending the code again.");return}let e=f.RO.credential(j,u),a=await (0,f.sB)(g,e),r=await a.user.getIdToken(),n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idToken:r})});if(n.ok){var t,s;let e=await n.json();(null===(t=e.user)||void 0===t?void 0:t.onboarding)?o("onboarding"):l((null===(s=e.user)||void 0===s?void 0:s.uid)||"")}else{let e=await n.json();v(e.message||"Backend authentication failed")}}catch(e){console.error("OTP verification error:",e),v(e.message||"Invalid OTP. Please try again.")}finally{b(!1)}},k=async e=>{e.preventDefault(),b(!0),v("");try{let e=await fetch("/api/onboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:E.name,birthdate:E.birthdate,almaMater:E.almaMater,gradYear:E.gradYear,hobbies:E.hobbies,bio:E.bio,city:E.city})});if(e.ok){let t=await e.json();l(t.userId)}else{let t=await e.json();v(t.message||"Failed to complete onboarding")}}catch(e){v("Network error. Please try again.")}finally{b(!1)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:n?"Join Cove to ".concat(n):"Join Cove"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(h.Z,{size:24})})]}),(0,a.jsxs)("div",{className:"p-6",children:[p&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:p}),"phone"===i&&(0,a.jsxs)("form",{onSubmit:D,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),(0,a.jsx)("input",{type:"tel",value:c,onChange:e=>d(e.target.value),placeholder:"(555) 123-4567",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,a.jsx)("button",{type:"submit",disabled:m,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:m?"Sending...":"Send Code"})]}),"otp"===i&&(0,a.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Enter the code sent to ",c]}),(0,a.jsx)("input",{type:"text",value:u,onChange:e=>x(e.target.value),placeholder:"123456",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,a.jsx)("button",{type:"submit",disabled:m,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:m?"Verifying...":"Verify Code"}),(0,a.jsx)("button",{type:"button",onClick:()=>o("phone"),className:"w-full text-blue-600 hover:text-blue-700 text-sm",children:"Back to phone number"})]}),"onboarding"===i&&(0,a.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,a.jsx)("input",{type:"text",value:E.name,onChange:e=>C(t=>({...t,name:e.target.value})),placeholder:"John Doe",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Birth Date *"}),(0,a.jsx)("input",{type:"date",value:E.birthdate,onChange:e=>C(t=>({...t,birthdate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"University *"}),(0,a.jsx)("input",{type:"text",value:E.almaMater,onChange:e=>C(t=>({...t,almaMater:e.target.value})),placeholder:"Stanford University",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Graduation Year *"}),(0,a.jsx)("input",{type:"text",value:E.gradYear,onChange:e=>C(t=>({...t,gradYear:e.target.value})),placeholder:"2024",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City"}),(0,a.jsx)("input",{type:"text",value:E.city,onChange:e=>C(t=>({...t,city:e.target.value})),placeholder:"San Francisco",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),(0,a.jsx)("textarea",{value:E.bio,onChange:e=>C(t=>({...t,bio:e.target.value})),placeholder:"Tell us about yourself...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsx)("button",{type:"submit",disabled:m,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:m?"Creating Account...":"Let's go"})]})]}),(0,a.jsx)("div",{id:"recaptcha-container"})]})}):null}async function j(){try{let e=await fetch("/api/auth/status",{method:"GET",credentials:"include"});if(!e.ok)return{isAuthenticated:!1};{let t=await e.json();return{isAuthenticated:!0,user:t.user}}}catch(e){return console.error("Auth check error:",e),{isAuthenticated:!1}}}function y(e){let{isOpen:t,onClose:s,eventId:l}=e,[n,i]=(0,r.useState)([]),[o,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)("");(0,r.useEffect)(()=>{t&&l&&m()},[t,l]);let m=async()=>{c(!0),u("");try{let e=await fetch("/api/event-members?eventId=".concat(l),{credentials:"include"});if(e.ok){let t=await e.json();i(t.members||[])}else{let t=await e.json();u(t.message||"Failed to load guests")}}catch(e){u("Network error. Please try again.")}finally{c(!1)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl max-w-md w-full max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"guest list"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(h.Z,{size:24})})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[o&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading guests..."})]}),d&&(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-red-600",children:d})}),!o&&!d&&0===n.length&&(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-gray-600",children:"No guests yet"})}),!o&&!d&&n.length>0&&(0,a.jsx)("div",{className:"space-y-4",children:n.map(e=>{var t;return(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-200 flex-shrink-0",children:(null===(t=e.profilePhoto)||void 0===t?void 0:t.url)?(0,a.jsx)("img",{src:e.profilePhoto.url,alt:e.name,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full bg-gray-300 flex items-center justify-center",children:(0,a.jsx)(x.Z,{size:20,className:"text-gray-500"})})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("p",{className:"text-gray-900 font-medium",children:e.name})})]},e.id)})})]})]})}):null}function N(e){var t,s,l;let{event:n}=e,[i,o]=(0,r.useState)(!1),[h,b]=(0,r.useState)(!1),[f,p]=(0,r.useState)(!1),[g,N]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{try{let{isAuthenticated:e}=await j();p(e)}catch(e){console.error("Auth check error:",e),p(!1)}finally{N(!1)}})()},[]);let w=async()=>{f?await D():o(!0)},E="GOING"===n.rsvpStatus||n.isHost,C=f&&n.paymentHandle,D=async()=>{try{let e=await fetch("/api/rsvp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:n.id,status:"PENDING"})});if(e.ok)alert("RSVP successful!");else{let t=await e.json();alert(t.message||"Failed to RSVP")}}catch(e){console.error("RSVP error:",e),alert("Failed to RSVP. Please try again.")}},S=n.name||"Untitled Event",k=(null===(t=n.host)||void 0===t?void 0:t.name)||"",P=function(e){try{let t=(0,c.D)(e);return(0,d.WU)(t,"EEEE, MMMM d")}catch(t){return console.error("Error formatting date:",t),e}}(n.date),B=function(e){try{let t=(0,c.D)(e);return(0,d.WU)(t,"h:mm a")}catch(e){return console.error("Error formatting time:",e),""}}(n.date),F=(null===(s=n.cove)||void 0===s?void 0:s.name)||"",I=k&&F?"hosted by ".concat(k," @ ").concat(F):k?"hosted by ".concat(k):F?"hosted by ".concat(F):"hosted by cove";return(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-20 items-start",children:[(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"font-libre-bodoni text-5xl lg:text-6xl text-[#5E1C1D] leading-[0.9] mb-4",children:S}),(0,a.jsx)("p",{className:"font-libre-bodoni text-base text-[#A8A8A8]",children:I})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-libre-bodoni text-lg text-[#2D2D2D] font-medium",children:P}),(0,a.jsx)("p",{className:"font-libre-bodoni text-base text-[#8B8B8B]",children:B.replace("AM","am").replace("PM","pm")})]}),(0,a.jsx)("div",{className:"h-px w-full bg-[#E5E5E5]"}),null!==n.ticketPrice&&void 0!==n.ticketPrice||null!==n.memberCap&&void 0!==n.memberCap?(0,a.jsxs)("div",{className:"flex items-center gap-8",children:[null!==n.ticketPrice&&void 0!==n.ticketPrice&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-6 bg-[#E8E8E8] rounded-sm"}),(0,a.jsxs)("span",{className:"font-libre-bodoni text-base text-[#2D2D2D]",children:["$",n.ticketPrice.toFixed(2)," per person"]})]}),null!==n.memberCap&&void 0!==n.memberCap&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-6 bg-[#E8E8E8] rounded-sm"}),(0,a.jsx)("span",{className:"font-libre-bodoni text-base text-[#2D2D2D]",children:void 0!==n.goingCount&&null!==n.goingCount?"".concat(Math.max(0,n.memberCap-n.goingCount),"/").concat(n.memberCap," spots left"):"".concat(n.memberCap," spots available")})]})]}):null,n.description&&(0,a.jsx)("div",{className:"space-y-4 max-w-md",children:(0,a.jsx)("div",{className:"font-libre-bodoni text-base text-[#2D2D2D] leading-relaxed whitespace-pre-wrap",children:n.description})}),E&&n.location&&(0,a.jsx)("div",{className:"space-y-4 max-w-md",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(u.Z,{size:16,className:"text-[#8B8B8B]"}),(0,a.jsx)("span",{className:"font-libre-bodoni text-base text-[#2D2D2D]",children:n.location})]})}),f&&!E&&(0,a.jsx)("div",{className:"space-y-4 max-w-md",children:(0,a.jsx)("div",{className:"font-libre-bodoni text-base text-[#8B8B8B]",children:"RSVP to see location and guest list"})})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"relative w-full aspect-square rounded-2xl overflow-hidden",children:(null===(l=n.coverPhoto)||void 0===l?void 0:l.url)?(0,a.jsx)(m.default,{src:n.coverPhoto.url,alt:S,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 50vw",priority:!0}):(0,a.jsx)("div",{className:"w-full h-full bg-gray-200"})}),E&&n.rsvps&&n.rsvps.length>0&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-libre-bodoni text-lg text-[#2D2D2D]",children:"guest list"}),(0,a.jsx)("button",{onClick:()=>b(!0),className:"text-[#5E1C1D] underline underline-offset-4 text-sm",children:"view all"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"flex -space-x-2",children:n.rsvps.slice(0,6).map((e,t)=>(0,a.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-white bg-gray-200",children:e.profilePhotoUrl?(0,a.jsx)("img",{src:e.profilePhotoUrl,alt:e.userName,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full bg-gray-300 flex items-center justify-center",children:(0,a.jsx)(x.Z,{size:16,className:"text-gray-500"})})},e.id))}),n.goingCount&&n.goingCount>6&&(0,a.jsxs)("span",{className:"font-libre-bodoni text-sm text-[#8B8B8B]",children:["+",n.goingCount-6," others going"]})]})]}),C&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("p",{className:"font-libre-bodoni text-sm text-[#2D2D2D]",children:["venmo @",n.paymentHandle]})}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("button",{onClick:w,className:"px-16 py-3 bg-[#F5F5F5] text-[#2D2D2D] rounded-full font-libre-bodoni text-lg border border-[#E5E5E5] hover:bg-[#EEEEEE] transition-colors",children:"rsvp"})})]})]}),(0,a.jsx)(v,{isOpen:i,onClose:()=>o(!1),onComplete:e=>{p(!0),o(!1),D()},originalAction:"RSVP to this event"}),(0,a.jsx)(y,{isOpen:h,onClose:()=>b(!1),eventId:n.id})]})}function w(){let e=(0,l.useParams)(),t=null==e?void 0:e.eventId,[s,i]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0),[u,x]=(0,r.useState)(null);return((0,r.useEffect)(()=>{t&&(async()=>{try{d(!0),x(null),console.log("Fetching event with ID:",t),console.log("API URL:","https://api.coveapp.co");let e=await o.fetchEvent(t);console.log("Event data received:",e),i(e)}catch(e){console.error("Error fetching event:",e),x(e instanceof Error?e.message:"Failed to load event")}finally{d(!1)}})()},[t]),c)?(0,a.jsx)("div",{className:"min-h-screen bg-[#F5F0E6] flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#5E1C1D] mx-auto mb-4"}),(0,a.jsx)("p",{className:"font-libre-bodoni text-[#5E1C1D]",children:"Loading event..."}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Event ID: ",t]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["API URL: ","https://api.coveapp.co"]})]})}):u?(0,a.jsx)("div",{className:"min-h-screen bg-[#F5F0E6] flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center max-w-md mx-auto px-6",children:[(0,a.jsx)("h2",{className:"font-libre-bodoni text-2xl font-semibold text-[#5E1C1D] mb-4",children:u.includes("not found")?"Event not found":"Something went wrong"}),(0,a.jsx)("p",{className:"font-libre-bodoni text-lg text-[#8B8B8B] mb-6",children:u}),(0,a.jsx)(n.default,{href:"/",className:"font-libre-bodoni text-[#5E1C1D] underline underline-offset-4",children:"Back to home"})]})}):s?(0,a.jsxs)("div",{className:"min-h-screen bg-[#F5F0E6]",children:[(0,a.jsx)("div",{className:"w-full px-8 pt-8 pb-12",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[(0,a.jsx)("span",{className:"font-libre-bodoni text-3xl text-[#5E1C1D]",children:"cove"}),(0,a.jsx)(n.default,{href:"/",className:"font-libre-bodoni text-[#5E1C1D] underline underline-offset-4 text-lg",children:"join the waitlist"})]})}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-8 pb-16",children:(0,a.jsx)(N,{event:s})})]}):(0,a.jsx)("div",{className:"min-h-screen bg-[#F5F0E6] flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center max-w-md mx-auto px-6",children:[(0,a.jsx)("h2",{className:"font-libre-bodoni text-2xl font-semibold text-[#5E1C1D] mb-4",children:"Event not found"}),(0,a.jsx)("p",{className:"font-libre-bodoni text-lg text-[#8B8B8B] mb-6",children:"This event may have been deleted or the link is incorrect."}),(0,a.jsx)(n.default,{href:"/",className:"font-libre-bodoni text-[#5E1C1D] underline underline-offset-4",children:"Back to home"})]})})}}},function(e){e.O(0,[15,205,971,117,744],function(){return e(e.s=6649)}),_N_E=e.O()}]);